name: detect changes workflow
on:
  push:
    paths:
      - "user-service/**"
      - '.github/workflows/**'
      - "auth-service/**"
jobs:
  detect_changes:
    runs-on: ubuntu-latest
    outputs:
      changed: ${{steps.get_changed.outputs.changed}}
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Set changes
        uses: Stockopedia/action-get-changed-files@v2
        id: get_changed
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          ignore: "**/+(.github)"
          format: "csv"
          foldersOnly: true

  auth-service:
    needs: detect_changes
    if: ${{contains(needs.detect_changes.outputs.changed,'auth-service')}}
    uses: ./.github/workflows/reusable_workflow.yml
    with:
      service_name: auth-service
    secrets: inherit
  user-service:
    needs: detect_changes
    if: ${{contains(needs.detect_changes.outputs.changed,'user-service')}}
    uses: ./.github/workflows/reusable_workflow.yml
    with:
      service_name: user-service
    secrets: inherit
  config-service:
    needs: detect_changes
    if: ${{contains(needs.detect_changes.outputs.changed,'config-service')}}
    uses: ./.github/workflows/reusable_workflow.yml
    with:
      service_name: config-service
    secrets: inherit
